registrationModule.controller("documentoController",function(e,o,a,i,n){var t=function(e,o,a,n){$("#btnEnviar").button("reset"),i.error("Ocurrio un problema")};e.VerDocumento=function(a){if(1==a.consultar)if(14==a.idDocumento)e.folioActual=a.folio,n.getDocsByFolio(a.folio).success(c).error(t);else{var r=a.existeDoc,l=o.obtieneTypeAplication(r),u=a.folio+" :: "+a.descripcion,s='<div id="hideFullContent"><div id="hideFullMenu" onclick="nodisponible()" ng-controller="documentoController"> </div> <object id="ifDocument" data="'+r+'" type="'+l+'" width="100%" height="100%"><p>Alternative text - include a link <a href="'+r+'">to the PDF!</a></p></object> </div>';$.createModal({title:u,message:s,closeButton:!1,scrollable:!1})}else i.warning("Acción no permitida para su perfil.")},o.obtieneTypeAplication=function(e){var o=e.split("."),a="application/pdf";switch(o[o.length-1].toLowerCase()){case"jpg":a="image/jpeg";break;case"png":a="image/png";break;case"gif":a="image/gif";break;case"jpeg":a="image/jpeg"}return a},e.NoDisponible=function(){i.error("Función deshabilitada en digitalización.")},e.ShowEnviar=function(e){1==e.enviarEmail?($("#modalSend").modal("show"),o.currentDocument=e):i.warning("Acción no permitida para su perfil.")};var r=function(e,o,a,n){i.success("Documento enviado correctamente."),$("#btnEnviar").button("reset"),$("#modalSend").modal("hide")},c=function(e,o,a,i){var n='<div id="hideFullContent"><div><ul class="nav nav-tabs"> ';angular.forEach(e,function(e,o){n=0==o?n+'<li class="active"><a data-toggle="tab" href="#divMenu'+o+'" target="_self">Póliza '+(o+1)+" </a></li>":n+'<li><a data-toggle="tab" href="#divMenu'+o+'" target="_self">Póliza '+(o+1)+" </a></li>"}),n+='</ul></div> <div class="tab-content">',angular.forEach(e,function(e,o){n=0==o?n+'<div class="tab-pane active" id="divMenu'+o+'"><iframe src="'+e+'" width="560" height="350" allowfullscreen="allowFullScreen"></iframe></div>':n+'<div class="tab-pane" id="divMenu'+o+'"><iframe src="'+e+'" width="560" height="350" allowfullscreen="allowFullScreen"></iframe></div>'}),n+="</div></div>",$.createModal({title:"Pólizas de Transferencia",message:n,closeButton:!1,scrollable:!1})};e.EnviarDocumento=function(){1==o.currentDocument.consultar?($("#btnEnviar").button("loading"),n.sendMail(o.currentDocument.idDocumento,o.currentDocument.folio,e.correoDestinatario).success(r).error(t)):i.warning("Acción no permitida para su perfil.")},e.openUpload=function(){var a={idProceso:1,idNodo:2,nombreNodo:"",folio:o.currentFolioFactura,nombreDocumento:"",idDocumento:15,origen:"",descripcion:"",idPerfil:"",consultar:"",imprimir:"",enviarEmail:"",descargar:"",cargar:"",estatusNombre:"",idEstatus:"",Ruta:"",existeDoc:""};e.ShowCargar(a)},e.ShowCargar=function(e){15==e.idDocumento&&"/factura"!=window.location.pathname?location.href="/factura?id="+e.folio+"&employee="+o.currentEmployee:($("#frameUpload").attr("src","/uploader"),$("#modalUpload").modal("show"),o.currentUpload=e)};var l=function(e,o,a,n){i.success("Documento cargado")};e.CargarDocumento=function(){n.uploadFile($("#fileDoc")[0].files[0]).success(l).error(t)},e.FinishUpload=function(e){i.success("Se guardo el documento "+e);var a=o.currentUpload;n.saveDocument(a.folio,a.idDocumento,1,1,a.idNodo,1,global_settings.uploadPath+"/"+e).success(u).error(t)};var u=function(e,a,n,t){i.success("Documento guardado.");var r=window.location.pathname;"/factura"==r?o.muestraDocumentos():setTimeout(function(){o.LoadActiveNode()},200)}});